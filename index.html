<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polymarket Sim â€” Paper Trading</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
/* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg-0:#0a0e17;--bg-1:#111827;--bg-2:#1a2235;--bg-3:#243049;
  --fg:#e2e8f0;--fg-dim:#94a3b8;--fg-muted:#64748b;
  --green:#22c55e;--green-bg:rgba(34,197,94,.12);
  --red:#ef4444;--red-bg:rgba(239,68,68,.12);
  --accent:#6366f1;--accent-bg:rgba(99,102,241,.12);
  --yellow:#eab308;
  --border:#1e293b;
  --radius:10px;
  --font:'SF Mono','Cascadia Code','Fira Code',monospace;
}
html{font-size:14px}
body{background:var(--bg-0);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;line-height:1.5}

/* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app{max-width:1280px;margin:0 auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap;gap:8px}
header h1{font-size:1.25rem;font-weight:700;letter-spacing:-.02em;display:flex;align-items:center;gap:8px}
header h1 .dot{width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.tag{font-size:.65rem;background:var(--accent-bg);color:var(--accent);padding:2px 8px;border-radius:99px;font-weight:600;text-transform:uppercase;letter-spacing:.05em}
.refresh-btn{background:var(--bg-2);border:1px solid var(--border);color:var(--fg-dim);padding:6px 14px;border-radius:6px;cursor:pointer;font-size:.8rem;transition:all .15s}
.refresh-btn:hover{background:var(--bg-3);color:var(--fg)}

/* â”€â”€â”€ Stats Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px}
.stat-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px}
.stat-card .label{font-size:.7rem;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px;font-weight:600}
.stat-card .value{font-size:1.4rem;font-weight:700;font-family:var(--font)}
.stat-card .sub{font-size:.75rem;color:var(--fg-dim);margin-top:2px}
.positive{color:var(--green)}.negative{color:var(--red)}.neutral{color:var(--fg)}

/* â”€â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chart-wrap{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px}
.chart-wrap h2{font-size:.85rem;color:var(--fg-dim);margin-bottom:12px;font-weight:600;text-transform:uppercase;letter-spacing:.06em}
.chart-wrap canvas{width:100%!important;max-height:240px}

/* â”€â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section{margin-bottom:24px}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.section-header h2{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--fg-dim)}
.section-header .count{font-size:.75rem;background:var(--bg-3);color:var(--fg-dim);padding:2px 8px;border-radius:99px}

/* â”€â”€â”€ Position Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.positions{display:grid;gap:10px}
.pos-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;display:grid;grid-template-columns:1fr auto;gap:8px;transition:border-color .15s}
.pos-card:hover{border-color:var(--bg-3)}
.pos-card .title{font-size:.85rem;font-weight:600;line-height:1.4;grid-column:1/-1}
.pos-card .meta{display:flex;gap:16px;flex-wrap:wrap;font-size:.75rem;color:var(--fg-dim);grid-column:1/-1}
.pos-card .meta span{display:flex;align-items:center;gap:4px}
.side-badge{font-size:.65rem;font-weight:700;padding:2px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.04em}
.side-yes{background:var(--green-bg);color:var(--green)}
.side-no{background:var(--red-bg);color:var(--red)}
.pnl-tag{font-family:var(--font);font-weight:700;font-size:.8rem}

/* â”€â”€â”€ History Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.history-table{width:100%;border-collapse:collapse;font-size:.8rem}
.history-table th{text-align:left;padding:8px 12px;border-bottom:1px solid var(--border);color:var(--fg-muted);font-weight:600;text-transform:uppercase;letter-spacing:.06em;font-size:.7rem}
.history-table td{padding:8px 12px;border-bottom:1px solid var(--border)}
.history-table tr:last-child td{border-bottom:none}
.history-table tr:hover{background:var(--bg-2)}

/* â”€â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty{text-align:center;padding:48px 20px;color:var(--fg-muted)}
.empty .icon{font-size:2.5rem;margin-bottom:12px}
.empty p{font-size:.85rem;max-width:360px;margin:0 auto}
.empty code{background:var(--bg-2);padding:2px 6px;border-radius:4px;font-family:var(--font);font-size:.75rem;color:var(--fg-dim)}

/* â”€â”€â”€ Signal Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.signals-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px}
.signal-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;transition:border-color .15s}
.signal-card:hover{border-color:var(--bg-3)}
.signal-card .sig-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.signal-card .sig-arrow{font-size:1.4rem;line-height:1}
.signal-card .sig-title{font-size:.82rem;font-weight:600;line-height:1.3;flex:1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.signal-card .sig-detail{display:flex;flex-wrap:wrap;gap:8px;font-size:.72rem;color:var(--fg-dim);margin-top:6px}
.signal-card .sig-detail span{display:flex;align-items:center;gap:3px}
.sig-badge{font-size:.6rem;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase;letter-spacing:.04em}
.sig-badge.up{background:var(--green-bg);color:var(--green)}
.sig-badge.down{background:var(--red-bg);color:var(--red)}
.sig-badge.bet-yes{background:var(--green-bg);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.sig-badge.bet-no{background:var(--red-bg);color:var(--red);border:1px solid rgba(239,68,68,.3)}
.sig-badge.no-bet{background:var(--bg-2);color:var(--fg-muted)}
.sig-price{font-family:var(--font);font-weight:600;font-size:.8rem}

/* â”€â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tab-bar{display:flex;gap:4px;margin-bottom:20px;border-bottom:1px solid var(--border);padding-bottom:0}
.tab-btn{background:none;border:none;color:var(--fg-muted);font-size:.82rem;font-weight:600;padding:10px 18px;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;text-transform:uppercase;letter-spacing:.05em}
.tab-btn:hover{color:var(--fg-dim)}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-content{display:none}
.tab-content.active{display:block}

/* â”€â”€â”€ Strategy Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.strat-updated{font-size:.72rem;color:var(--fg-muted);margin-bottom:18px;display:flex;align-items:center;gap:6px}
.strat-updated .pulse-dot{width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}

.strat-section-title{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--fg-dim);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.strat-section-title .icon{font-size:1.1rem}

.strat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px;margin-bottom:32px}
.strat-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:20px;transition:border-color .2s,transform .15s}
.strat-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.strat-card .strat-name{font-size:1rem;font-weight:700;margin-bottom:8px;line-height:1.4}
.strat-card .strat-desc{font-size:.8rem;color:var(--fg-dim);line-height:1.6;margin-bottom:12px}
.strat-card .strat-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.strat-card .strat-source{font-size:.72rem;color:var(--fg-muted)}
.strat-card .strat-source a{color:var(--accent);text-decoration:none;transition:color .15s}
.strat-card .strat-source a:hover{color:#818cf8;text-decoration:underline}

.risk-badge{font-size:.6rem;font-weight:700;padding:3px 10px;border-radius:99px;text-transform:uppercase;letter-spacing:.06em}
.risk-low{background:rgba(34,197,94,.12);color:var(--green)}
.risk-medium{background:rgba(234,179,8,.12);color:var(--yellow)}
.risk-high{background:rgba(239,68,68,.12);color:var(--red)}
.risk-mixed{background:rgba(99,102,241,.12);color:var(--accent)}

.appl-badge{font-size:.6rem;font-weight:600;padding:3px 10px;border-radius:99px;background:var(--bg-3);color:var(--fg-dim);letter-spacing:.02em}

/* â”€â”€â”€ Wallets Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wallets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:32px}
.wallet-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;display:flex;align-items:center;gap:14px;transition:border-color .15s}
.wallet-card:hover{border-color:var(--accent)}
.wallet-avatar{width:42px;height:42px;border-radius:50%;background:var(--accent-bg);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
.wallet-info{flex:1;min-width:0}
.wallet-info .wname{font-size:.88rem;font-weight:700}
.wallet-info .wstats{font-size:.75rem;color:var(--fg-dim);margin-top:2px}
.wallet-info .wsource{font-size:.68rem;margin-top:4px}
.wallet-info .wsource a{color:var(--accent);text-decoration:none}
.wallet-info .wsource a:hover{text-decoration:underline}

/* â”€â”€â”€ KOL List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kol-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:32px}
.kol-chip{background:var(--bg-1);border:1px solid var(--border);border-radius:99px;padding:6px 16px;font-size:.78rem;font-weight:600;color:var(--fg-dim);cursor:pointer;text-decoration:none;transition:all .15s;display:flex;align-items:center;gap:6px}
.kol-chip:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.kol-chip .x-icon{font-size:.7rem;opacity:.6}

/* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer{text-align:center;padding:24px 0;color:var(--fg-muted);font-size:.7rem;border-top:1px solid var(--border);margin-top:20px}

/* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:640px){
  .app{padding:10px}
  .stats-grid{grid-template-columns:repeat(2,1fr);gap:8px}
  .stat-card{padding:12px}
  .stat-card .value{font-size:1.1rem}
  .pos-card{padding:12px}
  .history-table{font-size:.72rem}
  .history-table th,.history-table td{padding:6px 8px}
  .strat-grid{grid-template-columns:1fr}
  .wallets-grid{grid-template-columns:1fr}
  .tab-btn{padding:8px 12px;font-size:.75rem}
  .strat-card{padding:14px}
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1><span class="dot"></span> Polymarket Sim <span class="tag">Paper</span></h1>
    <button class="refresh-btn" onclick="loadData()">â†» Refresh</button>
  </header>

  <!-- Tab Navigation -->
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
    <button class="tab-btn" data-tab="strategies" onclick="switchTab('strategies')">ğŸ“š Strategy Library</button>
  </div>

  <!-- Dashboard Tab -->
  <div class="tab-content active" id="tab-dashboard">

  <!-- Stats -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card"><div class="label">Total Equity</div><div class="value neutral" id="stEquity">$10,000.00</div></div>
    <div class="stat-card"><div class="label">Cash Balance</div><div class="value neutral" id="stCash">$10,000.00</div></div>
    <div class="stat-card"><div class="label">Total P&L</div><div class="value neutral" id="stPnl">$0.00</div><div class="sub" id="stRoi">ROI 0.00%</div></div>
    <div class="stat-card"><div class="label">Open Positions</div><div class="value neutral" id="stOpen">0</div></div>
    <div class="stat-card"><div class="label">Win Rate</div><div class="value neutral" id="stWinRate">â€”</div><div class="sub" id="stTrades">0 trades</div></div>
    <div class="stat-card"><div class="label">Sharpe Ratio</div><div class="value neutral" id="stSharpe">â€”</div></div>
  </div>

  <!-- Equity Curve -->
  <div class="chart-wrap">
    <h2>Equity Curve</h2>
    <canvas id="equityChart"></canvas>
  </div>

  <!-- Recent Signals -->
  <div class="section">
    <div class="section-header">
      <h2>Recent Signals</h2>
      <span class="count" id="signalCount">0</span>
    </div>
    <div class="signals-grid" id="signalsContainer">
      <div class="empty" id="emptySignals">
        <div class="icon">ğŸ“¡</div>
        <p>No signals yet. Run <code>node sim.mjs snapshot</code> twice, then <code>node sim.mjs scan</code></p>
      </div>
    </div>
  </div>

  <!-- Open Positions -->
  <div class="section">
    <div class="section-header">
      <h2>Open Positions</h2>
      <span class="count" id="openCount">0</span>
    </div>
    <div class="positions" id="positionsContainer">
      <div class="empty" id="emptyPositions">
        <div class="icon">ğŸ“­</div>
        <p>No open positions yet. Place your first bet:</p>
        <p style="margin-top:8px"><code>node sim.mjs bet --market &lt;slug&gt; --side YES --amount 100</code></p>
      </div>
    </div>
  </div>

  <!-- History -->
  <div class="section">
    <div class="section-header">
      <h2>Trade History</h2>
      <span class="count" id="histCount">0</span>
    </div>
    <div id="historyContainer">
      <div class="empty" id="emptyHistory">
        <div class="icon">ğŸ“‹</div>
        <p>No closed trades yet.</p>
      </div>
    </div>
  </div>

  </div><!-- /tab-dashboard -->

  <!-- Strategy Library Tab -->
  <div class="tab-content" id="tab-strategies">
    <div class="strat-updated" id="stratUpdated">
      <span class="pulse-dot"></span> Last updated: loading...
    </div>

    <!-- Strategies -->
    <div class="strat-section-title"><span class="icon">ğŸ§ </span> Trading Strategies</div>
    <div class="strat-grid" id="stratGrid">
      <div class="empty"><div class="icon">ğŸ“š</div><p>Loading strategies...</p></div>
    </div>

    <!-- Notable Wallets -->
    <div class="strat-section-title"><span class="icon">ğŸ‹</span> Notable Wallets</div>
    <div class="wallets-grid" id="walletsGrid">
      <div class="empty"><div class="icon">ğŸ‘›</div><p>Loading wallets...</p></div>
    </div>

    <!-- KOLs -->
    <div class="strat-section-title"><span class="icon">ğŸ“¡</span> KOLs to Track</div>
    <div class="kol-list" id="kolList">
      <span class="kol-chip">Loading...</span>
    </div>
  </div><!-- /tab-strategies -->

  <footer>Polymarket Paper Trading Simulator &mdash; Data is simulated. Not financial advice.</footer>
</div>

<script>
let chart = null;

function $(id){return document.getElementById(id)}
function fmt(v){return v>=0?`+$${v.toFixed(2)}`:`-$${Math.abs(v).toFixed(2)}`}
function fmtUsd(v){return `$${v.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}`}
function pnlClass(v){return v>0?'positive':v<0?'negative':'neutral'}
function pctStr(v){return (v*100).toFixed(1)+'Â¢'}

async function loadData(){
  try{
    const [portfolio,bets,history]=await Promise.all([
      fetch('data/portfolio.json').then(r=>r.json()),
      fetch('data/bets.json').then(r=>r.json()),
      fetch('data/history.json').then(r=>r.json()),
    ]);
    let signals=null;
    try{signals=await fetch('data/signals.json').then(r=>r.ok?r.json():null)}catch{}
    render(portfolio,bets,history,signals);
  }catch(e){
    console.error('Failed to load data:',e);
  }
}

function render(portfolio,bets,history,signalsData){
  // â”€â”€ Stats â”€â”€
  const openValue=bets.reduce((s,b)=>s+b.shares*(b.currentPrice||b.entryPrice),0);
  const openCost=bets.reduce((s,b)=>s+b.cost,0);
  const unrealizedPnl=openValue-openCost;
  const realizedPnl=history.reduce((s,h)=>s+(h.pnl||0),0);
  const totalPnl=realizedPnl+unrealizedPnl;
  const totalEquity=portfolio.cashBalance+openValue;
  const roi=(totalPnl/portfolio.initialBalance*100).toFixed(2);
  const wins=history.filter(h=>h.pnl>0).length;
  const winRate=history.length>0?(wins/history.length*100).toFixed(1)+'%':'â€”';

  $('stEquity').textContent=fmtUsd(totalEquity);
  $('stEquity').className='value '+pnlClass(totalPnl);
  $('stCash').textContent=fmtUsd(portfolio.cashBalance);
  $('stPnl').textContent=fmt(totalPnl);
  $('stPnl').className='value '+pnlClass(totalPnl);
  $('stRoi').textContent=`ROI ${roi}%`;
  $('stOpen').textContent=bets.length;
  $('stWinRate').textContent=winRate;
  $('stTrades').textContent=`${history.length} trades`;

  // Sharpe (annualized, from equity curve daily returns)
  const curve=portfolio.equityCurve||[];
  if(curve.length>=3){
    const returns=[];
    for(let i=1;i<curve.length;i++){
      returns.push((curve[i].equity-curve[i-1].equity)/curve[i-1].equity);
    }
    const mean=returns.reduce((a,b)=>a+b,0)/returns.length;
    const std=Math.sqrt(returns.reduce((a,r)=>a+Math.pow(r-mean,2),0)/returns.length);
    const sharpe=std>0?(mean/std*Math.sqrt(252)).toFixed(2):'â€”';
    $('stSharpe').textContent=sharpe;
  }else{
    $('stSharpe').textContent='â€”';
  }

  // â”€â”€ Equity Chart â”€â”€
  renderChart(curve,portfolio.initialBalance);

  // â”€â”€ Open Positions â”€â”€
  $('openCount').textContent=bets.length;
  const pc=$('positionsContainer');
  if(bets.length===0){
    pc.innerHTML=`<div class="empty"><div class="icon">ğŸ“­</div><p>No open positions yet. Place your first bet:</p><p style="margin-top:8px"><code>node sim.mjs bet --market &lt;slug&gt; --side YES --amount 100</code></p></div>`;
  }else{
    pc.innerHTML=bets.map(b=>{
      const cv=b.shares*(b.currentPrice||b.entryPrice);
      const pnl=cv-b.cost;
      const pnlPct=(pnl/b.cost*100).toFixed(1);
      return `<div class="pos-card">
        <div class="title">${esc(b.question||b.marketSlug)}</div>
        <div class="meta">
          <span class="side-badge side-${b.side.toLowerCase()}">${b.side}</span>
          <span>Entry ${pctStr(b.entryPrice)}</span>
          <span>Now ${pctStr(b.currentPrice||b.entryPrice)}</span>
          <span>${b.shares.toFixed(2)} shares</span>
          <span>Cost ${fmtUsd(b.cost)}</span>
          <span class="pnl-tag ${pnlClass(pnl)}">${fmt(pnl)} (${pnlPct}%)</span>
        </div>
      </div>`;
    }).join('');
  }

  // â”€â”€ History â”€â”€
  $('histCount').textContent=history.length;
  const hc=$('historyContainer');
  if(history.length===0){
    hc.innerHTML=`<div class="empty"><div class="icon">ğŸ“‹</div><p>No closed trades yet.</p></div>`;
  }else{
    const rows=history.slice().reverse().map(h=>{
      const icon=h.status==='won'?'ğŸ†':h.status==='lost'?'âŒ':'ğŸ’°';
      return `<tr>
        <td>${icon}</td>
        <td>${esc(h.question||h.marketSlug)}</td>
        <td><span class="side-badge side-${h.side.toLowerCase()}">${h.side}</span></td>
        <td>${pctStr(h.entryPrice)}</td>
        <td>${pctStr(h.exitPrice)}</td>
        <td>${fmtUsd(h.cost)}</td>
        <td class="${pnlClass(h.pnl)}">${fmt(h.pnl)}</td>
        <td>${h.closedAt?new Date(h.closedAt).toLocaleDateString():''}</td>
      </tr>`;
    }).join('');
    hc.innerHTML=`<div style="overflow-x:auto"><table class="history-table">
      <thead><tr><th></th><th>Market</th><th>Side</th><th>Entry</th><th>Exit</th><th>Cost</th><th>P&L</th><th>Closed</th></tr></thead>
      <tbody>${rows}</tbody>
    </table></div>`;
  }

  // â”€â”€ Signals â”€â”€
  const sc=$('signalsContainer');
  const sigs=signalsData&&signalsData.signals?signalsData.signals:[];
  $('signalCount').textContent=sigs.length;
  if(sigs.length===0){
    sc.innerHTML=`<div class="empty" style="grid-column:1/-1"><div class="icon">ğŸ“¡</div><p>No signals yet. Run <code>node sim.mjs snapshot</code> twice, then <code>node sim.mjs scan</code></p></div>`;
  }else{
    sc.innerHTML=sigs.map(s=>{
      const arrow=s.direction==='UP'?'ğŸŸ¢ â†‘':s.direction==='DOWN'?'ğŸ”´ â†“':'âšª â†’';
      const dirClass=s.direction==='UP'?'up':'down';
      const priceStr=`${(s.oldPrice*100).toFixed(1)}Â¢ â†’ ${(s.newPrice*100).toFixed(1)}Â¢`;
      const pctSign=parseFloat(s.pricePct)>0?'+':'';
      const volStr=s.volumeChange!=='N/A'?`Vol +${s.volumeChange}%`:'';
      const betBadge=s.betPlaced
        ?`<span class="sig-badge bet-${s.betSide?s.betSide.toLowerCase():'yes'}">âœ“ Bet ${s.betSide||''} $${(s.betAmount||0).toFixed(0)}</span>`
        :`<span class="sig-badge no-bet">No bet</span>`;
      const flags=[];
      if(s.isPriceSpike)flags.push(`<span class="sig-badge ${dirClass}">Price ${pctSign}${s.pricePct}%</span>`);
      if(s.isVolSpike)flags.push(`<span class="sig-badge ${dirClass}">Vol +${s.volumeChange}%</span>`);
      return `<div class="signal-card">
        <div class="sig-header">
          <span class="sig-arrow">${arrow}</span>
          <span class="sig-title">${esc(s.title)}</span>
        </div>
        <div class="sig-price">${priceStr}</div>
        <div class="sig-detail">
          ${flags.join('')}
          ${betBadge}
          ${volStr?`<span>ğŸ“Š ${volStr}</span>`:''}
        </div>
      </div>`;
    }).join('');
  }
}

function renderChart(curve,initialBalance){
  const ctx=$('equityChart').getContext('2d');
  if(chart)chart.destroy();
  
  const labels=curve.map(c=>c.date);
  const data=curve.map(c=>c.equity);
  const isUp=data.length>0&&data[data.length-1]>=initialBalance;

  chart=new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        data,
        borderColor:isUp?'#22c55e':'#ef4444',
        backgroundColor:isUp?'rgba(34,197,94,.08)':'rgba(239,68,68,.08)',
        fill:true,
        tension:.3,
        pointRadius:data.length>30?0:3,
        pointHoverRadius:5,
        borderWidth:2,
      },{
        data:Array(labels.length).fill(initialBalance),
        borderColor:'#334155',
        borderDash:[4,4],
        borderWidth:1,
        pointRadius:0,
        fill:false,
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:false},tooltip:{
        backgroundColor:'#1e293b',titleColor:'#e2e8f0',bodyColor:'#e2e8f0',borderColor:'#334155',borderWidth:1,
        callbacks:{label:ctx=>'$'+ctx.parsed.y.toLocaleString('en-US',{minimumFractionDigits:2})}
      }},
      scales:{
        x:{grid:{color:'#1e293b'},ticks:{color:'#64748b',maxTicksLimit:8,font:{size:11}}},
        y:{grid:{color:'#1e293b'},ticks:{color:'#64748b',font:{size:11},callback:v=>'$'+v.toLocaleString()}}
      }
    }
  });
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

// â”€â”€ Tab Switching â”€â”€
function switchTab(tab){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===tab));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.toggle('active',c.id==='tab-'+tab));
  if(tab==='strategies'&&!window._stratLoaded)loadStrategies();
}

// â”€â”€ Strategy Library â”€â”€
async function loadStrategies(){
  try{
    const data=await fetch('data/strategies.json').then(r=>r.json());
    window._stratLoaded=true;
    renderStrategies(data);
  }catch(e){
    console.error('Failed to load strategies:',e);
    $('stratGrid').innerHTML='<div class="empty" style="grid-column:1/-1"><div class="icon">âš ï¸</div><p>Failed to load strategies data.</p></div>';
  }
}

function riskClass(r){
  const rl=r.toLowerCase();
  if(rl.includes('very low')||rl==='low')return 'risk-low';
  if(rl.includes('low'))return 'risk-mixed';
  if(rl==='medium')return 'risk-medium';
  if(rl.includes('high'))return 'risk-high';
  return 'risk-medium';
}

function riskLabel(r){
  const rl=r.toLowerCase();
  if(rl.includes('very low'))return 'ğŸŸ¢ Very Low';
  if(rl==='low')return 'ğŸŸ¢ Low';
  if(rl.includes('low-medium')||rl.includes('low'))return 'ğŸŸ¡ Low-Med';
  if(rl==='medium')return 'ğŸŸ¡ Medium';
  if(rl.includes('high'))return 'ğŸ”´ High';
  return 'âšª '+r;
}

function renderStrategies(data){
  // Updated timestamp
  if(data.lastUpdated){
    const d=new Date(data.lastUpdated);
    $('stratUpdated').innerHTML=`<span class="pulse-dot"></span> Last updated: ${d.toLocaleString('en-US',{dateStyle:'medium',timeStyle:'short'})}`;
  }

  // Strategy cards
  const sg=$('stratGrid');
  if(data.strategies&&data.strategies.length>0){
    sg.innerHTML=data.strategies.map(s=>{
      const applTags=(s.applicability||'').split(',').map(t=>t.trim()).filter(Boolean).map(t=>`<span class="appl-badge">${esc(t)}</span>`).join('');
      const rBadge=s.risk?`<span class="risk-badge ${riskClass(s.risk)}">${riskLabel(s.risk)}</span>`:'';
      const sourceLink=s.sourceUrl?`<a href="${esc(s.sourceUrl)}" target="_blank" rel="noopener">ğ• ${esc(s.source)}</a>`:esc(s.source);
      return `<div class="strat-card">
        <div class="strat-name">${esc(s.name)}</div>
        <div class="strat-desc">${esc(s.description)}</div>
        <div class="strat-tags">${rBadge}${applTags}</div>
        <div class="strat-source">Source: ${sourceLink}</div>
      </div>`;
    }).join('');
  }else{
    sg.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="icon">ğŸ“š</div><p>No strategies found.</p></div>';
  }

  // Notable wallets
  const wg=$('walletsGrid');
  if(data.notableWallets&&data.notableWallets.length>0){
    wg.innerHTML=data.notableWallets.map(w=>{
      const initial=w.name.charAt(0).toUpperCase();
      const sourceLink=w.source?`<a href="${esc(w.source)}" target="_blank" rel="noopener">View source â†’</a>`:'';
      return `<div class="wallet-card">
        <div class="wallet-avatar">${initial}</div>
        <div class="wallet-info">
          <div class="wname">${esc(w.name)}</div>
          <div class="wstats">${esc(w.stats)}</div>
          <div class="wsource">${sourceLink}</div>
        </div>
      </div>`;
    }).join('');
  }else{
    wg.innerHTML='<div class="empty"><div class="icon">ğŸ‘›</div><p>No notable wallets.</p></div>';
  }

  // KOLs
  const kl=$('kolList');
  if(data.kols&&data.kols.length>0){
    kl.innerHTML=data.kols.map(h=>{
      const handle=h.startsWith('@')?h:'@'+h;
      const username=handle.slice(1);
      return `<a class="kol-chip" href="https://x.com/${esc(username)}" target="_blank" rel="noopener"><span class="x-icon">ğ•</span> ${esc(handle)}</a>`;
    }).join('');
  }else{
    kl.innerHTML='<span class="kol-chip">No KOLs tracked</span>';
  }
}

loadData();
</script>
</body>
</html>
