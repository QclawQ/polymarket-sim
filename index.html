<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polymarket Sim â€” Multi-Strategy Paper Trading</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
/* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg-0:#0a0e17;--bg-1:#111827;--bg-2:#1a2235;--bg-3:#243049;
  --fg:#e2e8f0;--fg-dim:#94a3b8;--fg-muted:#64748b;
  --green:#22c55e;--green-bg:rgba(34,197,94,.12);
  --red:#ef4444;--red-bg:rgba(239,68,68,.12);
  --accent:#6366f1;--accent-bg:rgba(99,102,241,.12);
  --yellow:#eab308;--yellow-bg:rgba(234,179,8,.12);
  --cyan:#06b6d4;--orange:#f97316;--pink:#ec4899;
  --border:#1e293b;
  --radius:10px;
  --font:'SF Mono','Cascadia Code','Fira Code',monospace;
}
html{font-size:14px}
body{background:var(--bg-0);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;line-height:1.5}

/* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app{max-width:1280px;margin:0 auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);margin-bottom:20px;flex-wrap:wrap;gap:8px}
header h1{font-size:1.25rem;font-weight:700;letter-spacing:-.02em;display:flex;align-items:center;gap:8px}
header h1 .dot{width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.tag{font-size:.65rem;background:var(--accent-bg);color:var(--accent);padding:2px 8px;border-radius:99px;font-weight:600;text-transform:uppercase;letter-spacing:.05em}
.refresh-btn{background:var(--bg-2);border:1px solid var(--border);color:var(--fg-dim);padding:6px 14px;border-radius:6px;cursor:pointer;font-size:.8rem;transition:all .15s}
.refresh-btn:hover{background:var(--bg-3);color:var(--fg)}

/* â”€â”€â”€ Stats Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:12px;margin-bottom:20px}
.stat-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px}
.stat-card .label{font-size:.7rem;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px;font-weight:600}
.stat-card .value{font-size:1.4rem;font-weight:700;font-family:var(--font)}
.stat-card .sub{font-size:.75rem;color:var(--fg-dim);margin-top:2px}
.positive{color:var(--green)}.negative{color:var(--red)}.neutral{color:var(--fg)}

/* â”€â”€â”€ Leaderboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.leaderboard-wrap{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px}
.leaderboard-wrap h2{font-size:.85rem;color:var(--fg-dim);margin-bottom:14px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;display:flex;align-items:center;gap:8px}
.lb-table{width:100%;border-collapse:collapse;font-size:.82rem}
.lb-table th{text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);color:var(--fg-muted);font-weight:600;text-transform:uppercase;letter-spacing:.06em;font-size:.68rem}
.lb-table th.num{text-align:right}
.lb-table td{padding:10px 12px;border-bottom:1px solid var(--border);transition:background .15s}
.lb-table td.num{text-align:right;font-family:var(--font);font-weight:600}
.lb-table tr.lb-row{cursor:pointer}
.lb-table tr.lb-row:hover td{background:var(--bg-2)}
.lb-table tr.lb-row.expanded td{background:var(--bg-2);border-bottom:none}
.lb-rank{font-weight:700;font-size:1rem;min-width:28px;display:inline-block}
.lb-strategy{font-weight:700;font-size:.88rem}
.lb-strategy-desc{font-size:.7rem;color:var(--fg-muted);margin-top:2px}

/* Strategy colors */
.strat-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:8px;flex-shrink:0}
.strat-momentum .strat-dot{background:#22c55e}
.strat-contrarian .strat-dot{background:#ef4444}
.strat-status_quo .strat-dot{background:#6366f1}
.strat-cheap_contracts .strat-dot{background:#eab308}
.strat-arb .strat-dot{background:#06b6d4}

/* Expanded detail row */
.lb-detail{display:none}
.lb-detail.show{display:table-row}
.lb-detail td{padding:0;border-bottom:1px solid var(--border)}
.lb-detail-inner{padding:12px 16px;background:var(--bg-2)}
.lb-detail-bets{font-size:.78rem;margin-top:8px}
.lb-detail-bets .bet-row{display:flex;gap:12px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);align-items:center;flex-wrap:wrap}
.lb-detail-bets .bet-row:last-child{border-bottom:none}
.lb-detail-stats{display:flex;gap:20px;flex-wrap:wrap;margin-bottom:8px;font-size:.76rem;color:var(--fg-dim)}
.lb-detail-stats span{display:flex;align-items:center;gap:4px}
.lb-no-bets{color:var(--fg-muted);font-size:.78rem;font-style:italic;padding:8px 0}

/* â”€â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chart-wrap{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px}
.chart-wrap h2{font-size:.85rem;color:var(--fg-dim);margin-bottom:12px;font-weight:600;text-transform:uppercase;letter-spacing:.06em}
.chart-wrap canvas{width:100%!important;max-height:280px}
.chart-legend{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;font-size:.75rem}
.chart-legend-item{display:flex;align-items:center;gap:6px;cursor:pointer;opacity:.9;transition:opacity .15s}
.chart-legend-item:hover{opacity:1}
.chart-legend-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}

/* â”€â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section{margin-bottom:24px}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.section-header h2{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--fg-dim)}
.section-header .count{font-size:.75rem;background:var(--bg-3);color:var(--fg-dim);padding:2px 8px;border-radius:99px}

/* â”€â”€â”€ Position Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.positions{display:grid;gap:10px}
.pos-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;transition:border-color .15s}
.pos-card:hover{border-color:var(--bg-3)}
.pos-card .title{font-size:.85rem;font-weight:600;line-height:1.4;margin-bottom:6px}
.pos-card .meta{display:flex;gap:12px;flex-wrap:wrap;font-size:.75rem;color:var(--fg-dim)}
.pos-card .meta span{display:flex;align-items:center;gap:4px}
.side-badge{font-size:.65rem;font-weight:700;padding:2px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.04em}
.side-yes{background:var(--green-bg);color:var(--green)}
.side-no{background:var(--red-bg);color:var(--red)}
.strat-badge{font-size:.6rem;font-weight:700;padding:2px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.04em;background:var(--accent-bg);color:var(--accent)}
.pnl-tag{font-family:var(--font);font-weight:700;font-size:.8rem}

/* â”€â”€â”€ History Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.history-table{width:100%;border-collapse:collapse;font-size:.8rem}
.history-table th{text-align:left;padding:8px 12px;border-bottom:1px solid var(--border);color:var(--fg-muted);font-weight:600;text-transform:uppercase;letter-spacing:.06em;font-size:.7rem}
.history-table td{padding:8px 12px;border-bottom:1px solid var(--border)}
.history-table tr:last-child td{border-bottom:none}
.history-table tr:hover{background:var(--bg-2)}

/* â”€â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty{text-align:center;padding:48px 20px;color:var(--fg-muted)}
.empty .icon{font-size:2.5rem;margin-bottom:12px}
.empty p{font-size:.85rem;max-width:360px;margin:0 auto}
.empty code{background:var(--bg-2);padding:2px 6px;border-radius:4px;font-family:var(--font);font-size:.75rem;color:var(--fg-dim)}

/* â”€â”€â”€ Signal Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.signals-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px}
.signal-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;transition:border-color .15s}
.signal-card:hover{border-color:var(--bg-3)}
.signal-card .sig-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.signal-card .sig-arrow{font-size:1.4rem;line-height:1}
.signal-card .sig-title{font-size:.82rem;font-weight:600;line-height:1.3;flex:1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.signal-card .sig-detail{display:flex;flex-wrap:wrap;gap:8px;font-size:.72rem;color:var(--fg-dim);margin-top:6px}
.signal-card .sig-detail span{display:flex;align-items:center;gap:3px}
.sig-badge{font-size:.6rem;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase;letter-spacing:.04em}
.sig-badge.up{background:var(--green-bg);color:var(--green)}
.sig-badge.down{background:var(--red-bg);color:var(--red)}
.sig-badge.bet-yes{background:var(--green-bg);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.sig-badge.bet-no{background:var(--red-bg);color:var(--red);border:1px solid rgba(239,68,68,.3)}
.sig-badge.no-bet{background:var(--bg-2);color:var(--fg-muted)}
.sig-price{font-family:var(--font);font-weight:600;font-size:.8rem}

/* â”€â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tab-bar{display:flex;gap:4px;margin-bottom:20px;border-bottom:1px solid var(--border);padding-bottom:0}
.tab-btn{background:none;border:none;color:var(--fg-muted);font-size:.82rem;font-weight:600;padding:10px 18px;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;text-transform:uppercase;letter-spacing:.05em}
.tab-btn:hover{color:var(--fg-dim)}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-content{display:none}
.tab-content.active{display:block}

/* â”€â”€â”€ Strategy Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.strat-updated{font-size:.72rem;color:var(--fg-muted);margin-bottom:18px;display:flex;align-items:center;gap:6px}
.strat-updated .pulse-dot{width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite}

.strat-section-title{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--fg-dim);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.strat-section-title .icon{font-size:1.1rem}

.strat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px;margin-bottom:32px}
.strat-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:20px;transition:border-color .2s,transform .15s}
.strat-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.strat-card .strat-name{font-size:1rem;font-weight:700;margin-bottom:8px;line-height:1.4}
.strat-card .strat-desc{font-size:.8rem;color:var(--fg-dim);line-height:1.6;margin-bottom:12px}
.strat-card .strat-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.strat-card .strat-source{font-size:.72rem;color:var(--fg-muted)}
.strat-card .strat-source a{color:var(--accent);text-decoration:none;transition:color .15s}
.strat-card .strat-source a:hover{color:#818cf8;text-decoration:underline}

.risk-badge{font-size:.6rem;font-weight:700;padding:3px 10px;border-radius:99px;text-transform:uppercase;letter-spacing:.06em}
.risk-low{background:rgba(34,197,94,.12);color:var(--green)}
.risk-medium{background:rgba(234,179,8,.12);color:var(--yellow)}
.risk-high{background:rgba(239,68,68,.12);color:var(--red)}
.risk-mixed{background:rgba(99,102,241,.12);color:var(--accent)}

.appl-badge{font-size:.6rem;font-weight:600;padding:3px 10px;border-radius:99px;background:var(--bg-3);color:var(--fg-dim);letter-spacing:.02em}

/* â”€â”€â”€ Wallets Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wallets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:32px}
.wallet-card{background:var(--bg-1);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;display:flex;align-items:center;gap:14px;transition:border-color .15s}
.wallet-card:hover{border-color:var(--accent)}
.wallet-avatar{width:42px;height:42px;border-radius:50%;background:var(--accent-bg);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
.wallet-info{flex:1;min-width:0}
.wallet-info .wname{font-size:.88rem;font-weight:700}
.wallet-info .wstats{font-size:.75rem;color:var(--fg-dim);margin-top:2px}
.wallet-info .wsource{font-size:.68rem;margin-top:4px}
.wallet-info .wsource a{color:var(--accent);text-decoration:none}
.wallet-info .wsource a:hover{text-decoration:underline}

/* â”€â”€â”€ KOL List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kol-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:32px}
.kol-chip{background:var(--bg-1);border:1px solid var(--border);border-radius:99px;padding:6px 16px;font-size:.78rem;font-weight:600;color:var(--fg-dim);cursor:pointer;text-decoration:none;transition:all .15s;display:flex;align-items:center;gap:6px}
.kol-chip:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg)}
.kol-chip .x-icon{font-size:.7rem;opacity:.6}

/* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer{text-align:center;padding:24px 0;color:var(--fg-muted);font-size:.7rem;border-top:1px solid var(--border);margin-top:20px}

/* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:640px){
  .app{padding:10px}
  .stats-grid{grid-template-columns:repeat(2,1fr);gap:8px}
  .stat-card{padding:12px}
  .stat-card .value{font-size:1.1rem}
  .pos-card{padding:12px}
  .history-table{font-size:.72rem}
  .history-table th,.history-table td{padding:6px 8px}
  .lb-table{font-size:.72rem}
  .lb-table th,.lb-table td{padding:6px 8px}
  .strat-grid{grid-template-columns:1fr}
  .wallets-grid{grid-template-columns:1fr}
  .tab-btn{padding:8px 12px;font-size:.75rem}
  .strat-card{padding:14px}
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1><span class="dot"></span> Polymarket Sim <span class="tag">Multi-Strategy</span></h1>
    <button class="refresh-btn" onclick="loadData()">â†» Refresh</button>
  </header>

  <!-- Tab Navigation -->
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
    <button class="tab-btn" data-tab="strategies" onclick="switchTab('strategies')">ğŸ“š Strategy Library</button>
  </div>

  <!-- Dashboard Tab -->
  <div class="tab-content active" id="tab-dashboard">

  <!-- Stats -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card"><div class="label">Total Equity</div><div class="value neutral" id="stEquity">$10,000.00</div></div>
    <div class="stat-card"><div class="label">Total Cash</div><div class="value neutral" id="stCash">$10,000.00</div></div>
    <div class="stat-card"><div class="label">Total P&L</div><div class="value neutral" id="stPnl">$0.00</div><div class="sub" id="stRoi">ROI 0.00%</div></div>
    <div class="stat-card"><div class="label">Open Positions</div><div class="value neutral" id="stOpen">0</div></div>
    <div class="stat-card"><div class="label">Win Rate</div><div class="value neutral" id="stWinRate">â€”</div><div class="sub" id="stTrades">0 trades</div></div>
    <div class="stat-card"><div class="label">Strategies Active</div><div class="value neutral" id="stStrats">5</div></div>
  </div>

  <!-- Strategy Leaderboard -->
  <div class="leaderboard-wrap" id="leaderboardWrap">
    <h2>ğŸ† Strategy Leaderboard</h2>
    <table class="lb-table" id="lbTable">
      <thead>
        <tr>
          <th style="width:40px">#</th>
          <th>Strategy</th>
          <th class="num">Win %</th>
          <th class="num">P&L</th>
          <th class="num">ROI %</th>
          <th class="num">Sharpe</th>
          <th class="num">Open</th>
        </tr>
      </thead>
      <tbody id="lbBody"></tbody>
    </table>
  </div>

  <!-- Multi-Strategy Equity Curve -->
  <div class="chart-wrap">
    <h2>Equity Curves â€” All Strategies</h2>
    <canvas id="equityChart"></canvas>
    <div class="chart-legend" id="chartLegend"></div>
  </div>

  <!-- Recent Signals -->
  <div class="section">
    <div class="section-header">
      <h2>Recent Signals</h2>
      <span class="count" id="signalCount">0</span>
    </div>
    <div class="signals-grid" id="signalsContainer">
      <div class="empty" id="emptySignals">
        <div class="icon">ğŸ“¡</div>
        <p>No signals yet. Run <code>node sim.mjs snapshot</code> twice, then <code>node sim.mjs scan</code></p>
      </div>
    </div>
  </div>

  <!-- Open Positions -->
  <div class="section">
    <div class="section-header">
      <h2>Open Positions</h2>
      <span class="count" id="openCount">0</span>
    </div>
    <div class="positions" id="positionsContainer">
      <div class="empty" id="emptyPositions">
        <div class="icon">ğŸ“­</div>
        <p>No open positions yet. Run:</p>
        <p style="margin-top:8px"><code>node sim.mjs auto-bet</code></p>
      </div>
    </div>
  </div>

  <!-- History -->
  <div class="section">
    <div class="section-header">
      <h2>Trade History</h2>
      <span class="count" id="histCount">0</span>
    </div>
    <div id="historyContainer">
      <div class="empty" id="emptyHistory">
        <div class="icon">ğŸ“‹</div>
        <p>No closed trades yet.</p>
      </div>
    </div>
  </div>

  </div><!-- /tab-dashboard -->

  <!-- Strategy Library Tab -->
  <div class="tab-content" id="tab-strategies">
    <div class="strat-updated" id="stratUpdated">
      <span class="pulse-dot"></span> Last updated: loading...
    </div>

    <div class="strat-section-title"><span class="icon">ğŸ§ </span> Trading Strategies</div>
    <div class="strat-grid" id="stratGrid">
      <div class="empty"><div class="icon">ğŸ“š</div><p>Loading strategies...</p></div>
    </div>

    <div class="strat-section-title"><span class="icon">ğŸ‹</span> Notable Wallets</div>
    <div class="wallets-grid" id="walletsGrid">
      <div class="empty"><div class="icon">ğŸ‘›</div><p>Loading wallets...</p></div>
    </div>

    <div class="strat-section-title"><span class="icon">ğŸ“¡</span> KOLs to Track</div>
    <div class="kol-list" id="kolList">
      <span class="kol-chip">Loading...</span>
    </div>
  </div><!-- /tab-strategies -->

  <footer>Polymarket Paper Trading Simulator â€” Multi-Strategy Engine â€” Not financial advice.</footer>
</div>

<script>
let chart = null;

const STRATEGY_NAMES = ['momentum', 'contrarian', 'status_quo', 'cheap_contracts', 'arb'];
const STRATEGY_LABELS = {
  momentum: 'ğŸ“ˆ Momentum',
  contrarian: 'ğŸ“‰ Contrarian',
  status_quo: 'ğŸ›ï¸ Status Quo',
  cheap_contracts: 'ğŸ° Cheap Contracts',
  arb: 'âš–ï¸ Arbitrage',
};
const STRATEGY_DESCRIPTIONS = {
  momentum: 'Follow price spikes >10%',
  contrarian: 'Fade price spikes (opposite)',
  status_quo: 'Bet against unlikely events',
  cheap_contracts: 'Lottery tickets <5Â¢',
  arb: 'YES+NO pricing gaps',
};
const STRATEGY_COLORS = {
  momentum: '#22c55e',
  contrarian: '#ef4444',
  status_quo: '#6366f1',
  cheap_contracts: '#eab308',
  arb: '#06b6d4',
};

function $(id){return document.getElementById(id)}
function fmt(v){return v>=0?`+$${v.toFixed(2)}`:`-$${Math.abs(v).toFixed(2)}`}
function fmtUsd(v){return `$${v.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}`}
function pnlClass(v){return v>0?'positive':v<0?'negative':'neutral'}
function pctStr(v){return (v*100).toFixed(1)+'Â¢'}

function computeStratStats(name, portfolio, bets, history) {
  const strat = portfolio.strategies[name];
  if (!strat) return null;
  const openBets = bets.filter(b => b.strategy === name && b.status === 'open');
  const closedBets = history.filter(h => h.strategy === name);

  const openValue = openBets.reduce((s, b) => s + b.shares * (b.currentPrice || b.entryPrice), 0);
  const openCost = openBets.reduce((s, b) => s + b.cost, 0);
  const unrealizedPnl = openValue - openCost;
  const realizedPnl = closedBets.reduce((s, h) => s + (h.pnl || 0), 0);
  const totalPnl = realizedPnl + unrealizedPnl;
  const totalEquity = strat.cash + openValue;
  const initialCash = strat.initialCash || 2000;
  const roi = (totalPnl / initialCash * 100);
  const wins = closedBets.filter(h => (h.pnl || 0) > 0).length;
  const winRate = closedBets.length > 0 ? (wins / closedBets.length * 100) : null;

  // Sharpe
  const curve = strat.equityCurve || [];
  let sharpe = null;
  if (curve.length >= 3) {
    const returns = [];
    for (let i = 1; i < curve.length; i++) {
      returns.push((curve[i].equity - curve[i-1].equity) / curve[i-1].equity);
    }
    const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
    const std = Math.sqrt(returns.reduce((a, r) => a + Math.pow(r - mean, 2), 0) / returns.length);
    sharpe = std > 0 ? parseFloat((mean / std * Math.sqrt(252)).toFixed(2)) : null;
  }

  return {
    name, cash: strat.cash, initialCash, totalEquity, openValue,
    unrealizedPnl, realizedPnl, totalPnl, roi, wins,
    losses: closedBets.filter(h => (h.pnl||0) <= 0).length,
    winRate, trades: closedBets.length, sharpe,
    openPositions: openBets.length,
    equityCurve: curve,
    openBets, closedBets,
  };
}

async function loadData(){
  try{
    const [portfolio,bets,history]=await Promise.all([
      fetch('data/portfolio.json').then(r=>r.json()),
      fetch('data/bets.json').then(r=>r.json()),
      fetch('data/history.json').then(r=>r.json()),
    ]);
    let signals=null;
    try{signals=await fetch('data/signals.json').then(r=>r.ok?r.json():null)}catch{}
    render(portfolio,bets,history,signals);
  }catch(e){
    console.error('Failed to load data:',e);
  }
}

function render(portfolio,bets,history,signalsData){
  // Check for new multi-strategy format
  const isMultiStrategy = portfolio.strategies != null;
  if (!isMultiStrategy) {
    // Legacy fallback
    renderLegacy(portfolio, bets, history, signalsData);
    return;
  }

  // â”€â”€ Aggregate Stats â”€â”€
  let totalCash = 0, totalOpenValue = 0, totalRealizedPnl = 0, totalOpenCost = 0;
  const allStats = {};
  for (const name of STRATEGY_NAMES) {
    const s = computeStratStats(name, portfolio, bets, history);
    if (s) {
      allStats[name] = s;
      totalCash += s.cash;
      totalOpenValue += s.openValue;
      totalRealizedPnl += s.realizedPnl;
      totalOpenCost += bets.filter(b => b.strategy === name && b.status === 'open').reduce((sum, b) => sum + b.cost, 0);
    }
  }
  const totalUnrealizedPnl = totalOpenValue - totalOpenCost;
  const totalPnl = totalRealizedPnl + totalUnrealizedPnl;
  const totalEquity = totalCash + totalOpenValue;
  const totalInitial = portfolio.totalInitial || 10000;
  const roi = (totalPnl / totalInitial * 100).toFixed(2);
  const allClosed = history;
  const wins = allClosed.filter(h => (h.pnl||0) > 0).length;
  const winRate = allClosed.length > 0 ? (wins / allClosed.length * 100).toFixed(1) + '%' : 'â€”';
  const activeStrats = Object.values(allStats).filter(s => s.openPositions > 0 || s.trades > 0).length;
  const openBetsAll = bets.filter(b => b.status === 'open');

  $('stEquity').textContent = fmtUsd(totalEquity);
  $('stEquity').className = 'value ' + pnlClass(totalPnl);
  $('stCash').textContent = fmtUsd(totalCash);
  $('stPnl').textContent = fmt(totalPnl);
  $('stPnl').className = 'value ' + pnlClass(totalPnl);
  $('stRoi').textContent = `ROI ${roi}%`;
  $('stOpen').textContent = openBetsAll.length;
  $('stWinRate').textContent = winRate;
  $('stTrades').textContent = `${allClosed.length} trades`;
  $('stStrats').textContent = activeStrats || STRATEGY_NAMES.length;

  // â”€â”€ Leaderboard â”€â”€
  renderLeaderboard(allStats, bets);

  // â”€â”€ Multi-Strategy Equity Chart â”€â”€
  renderMultiChart(allStats, totalInitial);

  // â”€â”€ Open Positions (grouped by strategy) â”€â”€
  $('openCount').textContent = openBetsAll.length;
  const pc = $('positionsContainer');
  if (openBetsAll.length === 0) {
    pc.innerHTML = `<div class="empty"><div class="icon">ğŸ“­</div><p>No open positions. Run <code>node sim.mjs auto-bet</code> to start all strategies.</p></div>`;
  } else {
    let html = '';
    for (const name of STRATEGY_NAMES) {
      const stratBets = openBetsAll.filter(b => b.strategy === name);
      if (stratBets.length === 0) continue;
      html += stratBets.map(b => {
        const cv = b.shares * (b.currentPrice || b.entryPrice);
        const pnl = cv - b.cost;
        const pnlPct = (pnl / b.cost * 100).toFixed(1);
        return `<div class="pos-card">
          <div class="title">${esc(b.question || b.marketSlug)}</div>
          <div class="meta">
            <span class="strat-badge">${name}</span>
            <span class="side-badge side-${b.side.toLowerCase()}">${b.side}</span>
            <span>Entry ${pctStr(b.entryPrice)}</span>
            <span>Now ${pctStr(b.currentPrice || b.entryPrice)}</span>
            <span>${b.shares.toFixed(2)} shares</span>
            <span>Cost ${fmtUsd(b.cost)}</span>
            <span class="pnl-tag ${pnlClass(pnl)}">${fmt(pnl)} (${pnlPct}%)</span>
          </div>
        </div>`;
      }).join('');
    }
    pc.innerHTML = html;
  }

  // â”€â”€ History â”€â”€
  $('histCount').textContent = history.length;
  const hc = $('historyContainer');
  if (history.length === 0) {
    hc.innerHTML = `<div class="empty"><div class="icon">ğŸ“‹</div><p>No closed trades yet.</p></div>`;
  } else {
    const rows = history.slice().reverse().slice(0, 50).map(h => {
      const icon = h.status === 'won' ? 'ğŸ†' : h.status === 'lost' ? 'âŒ' : 'ğŸ’°';
      return `<tr>
        <td>${icon}</td>
        <td><span class="strat-badge">${h.strategy || 'â€”'}</span></td>
        <td>${esc(h.question || h.marketSlug)}</td>
        <td><span class="side-badge side-${(h.side||'').toLowerCase()}">${h.side}</span></td>
        <td>${pctStr(h.entryPrice)}</td>
        <td>${pctStr(h.exitPrice)}</td>
        <td>${fmtUsd(h.cost)}</td>
        <td class="${pnlClass(h.pnl)}">${fmt(h.pnl)}</td>
        <td>${h.closedAt?new Date(h.closedAt).toLocaleDateString():''}</td>
      </tr>`;
    }).join('');
    hc.innerHTML = `<div style="overflow-x:auto"><table class="history-table">
      <thead><tr><th></th><th>Strategy</th><th>Market</th><th>Side</th><th>Entry</th><th>Exit</th><th>Cost</th><th>P&L</th><th>Closed</th></tr></thead>
      <tbody>${rows}</tbody>
    </table></div>`;
  }

  // â”€â”€ Signals â”€â”€
  const sc = $('signalsContainer');
  const sigs = signalsData && signalsData.signals ? signalsData.signals : [];
  $('signalCount').textContent = sigs.length;
  if (sigs.length === 0) {
    sc.innerHTML = `<div class="empty" style="grid-column:1/-1"><div class="icon">ğŸ“¡</div><p>No signals yet. Run <code>node sim.mjs snapshot</code> twice, then <code>node sim.mjs scan</code></p></div>`;
  } else {
    sc.innerHTML = sigs.map(s => {
      const arrow = s.direction === 'UP' ? 'ğŸŸ¢ â†‘' : s.direction === 'DOWN' ? 'ğŸ”´ â†“' : 'âšª â†’';
      const dirClass = s.direction === 'UP' ? 'up' : 'down';
      const priceStr = `${(s.oldPrice*100).toFixed(1)}Â¢ â†’ ${(s.newPrice*100).toFixed(1)}Â¢`;
      const pctSign = parseFloat(s.pricePct) > 0 ? '+' : '';
      const betBadge = s.betPlaced
        ? `<span class="sig-badge bet-${s.betSide?s.betSide.toLowerCase():'yes'}">âœ“ Bet ${s.betSide||''} $${(s.betAmount||0).toFixed(0)}</span>`
        : `<span class="sig-badge no-bet">No bet</span>`;
      const flags = [];
      if (s.isPriceSpike) flags.push(`<span class="sig-badge ${dirClass}">Price ${pctSign}${s.pricePct}%</span>`);
      if (s.isVolSpike) flags.push(`<span class="sig-badge ${dirClass}">Vol +${s.volumeChange}%</span>`);
      return `<div class="signal-card">
        <div class="sig-header">
          <span class="sig-arrow">${arrow}</span>
          <span class="sig-title">${esc(s.title)}</span>
        </div>
        <div class="sig-price">${priceStr}</div>
        <div class="sig-detail">
          ${flags.join('')}
          ${betBadge}
        </div>
      </div>`;
    }).join('');
  }
}

function renderLeaderboard(allStats, bets) {
  const sorted = Object.values(allStats).sort((a, b) => b.roi - a.roi);
  const body = $('lbBody');

  body.innerHTML = sorted.map((s, i) => {
    const rank = i === 0 ? 'ğŸ†' : `#${i+1}`;
    const color = STRATEGY_COLORS[s.name];
    const label = STRATEGY_LABELS[s.name] || s.name;
    const desc = STRATEGY_DESCRIPTIONS[s.name] || '';
    const winStr = s.winRate !== null ? s.winRate.toFixed(1) + '%' : 'â€”';
    const sharpeStr = s.sharpe !== null ? s.sharpe.toFixed(2) : 'â€”';
    const pnlCls = pnlClass(s.totalPnl);
    const roiCls = pnlClass(s.roi);

    // Open bets for this strategy
    const stratBets = s.openBets || [];
    const betRows = stratBets.length > 0
      ? stratBets.map(b => {
          const cv = b.shares * (b.currentPrice || b.entryPrice);
          const pnl = cv - b.cost;
          return `<div class="bet-row">
            <span class="side-badge side-${b.side.toLowerCase()}">${b.side}</span>
            <span style="flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(b.question || b.marketSlug)}</span>
            <span style="font-family:var(--font)">${pctStr(b.entryPrice)} â†’ ${pctStr(b.currentPrice || b.entryPrice)}</span>
            <span class="pnl-tag ${pnlClass(pnl)}">${fmt(pnl)}</span>
          </div>`;
        }).join('')
      : `<div class="lb-no-bets">No open positions</div>`;

    return `
      <tr class="lb-row strat-${s.name}" onclick="toggleLbDetail('lb-detail-${s.name}', this)">
        <td><span class="lb-rank">${rank}</span></td>
        <td>
          <div style="display:flex;align-items:center">
            <span class="strat-dot" style="background:${color}"></span>
            <div>
              <div class="lb-strategy">${label}</div>
              <div class="lb-strategy-desc">${desc}</div>
            </div>
          </div>
        </td>
        <td class="num">${winStr}</td>
        <td class="num ${pnlCls}">${fmt(s.totalPnl)}</td>
        <td class="num ${roiCls}">${s.roi.toFixed(1)}%</td>
        <td class="num">${sharpeStr}</td>
        <td class="num">${s.openPositions}</td>
      </tr>
      <tr class="lb-detail" id="lb-detail-${s.name}">
        <td colspan="7">
          <div class="lb-detail-inner">
            <div class="lb-detail-stats">
              <span>ğŸ’° Cash: ${fmtUsd(s.cash)}</span>
              <span>ğŸ“Š Equity: ${fmtUsd(s.totalEquity)}</span>
              <span>ğŸ“ˆ Realized: <span class="${pnlClass(s.realizedPnl)}">${fmt(s.realizedPnl)}</span></span>
              <span>ğŸ“‰ Unrealized: <span class="${pnlClass(s.unrealizedPnl)}">${fmt(s.unrealizedPnl)}</span></span>
              <span>ğŸ¯ W/L: ${s.wins}/${s.losses}</span>
              <span>ğŸ“‹ Trades: ${s.trades}</span>
            </div>
            <div class="lb-detail-bets">${betRows}</div>
          </div>
        </td>
      </tr>`;
  }).join('');
}

function toggleLbDetail(id, row) {
  const detail = document.getElementById(id);
  if (!detail) return;
  const isOpen = detail.classList.contains('show');
  // Close all
  document.querySelectorAll('.lb-detail').forEach(d => d.classList.remove('show'));
  document.querySelectorAll('.lb-row').forEach(r => r.classList.remove('expanded'));
  if (!isOpen) {
    detail.classList.add('show');
    row.classList.add('expanded');
  }
}

function renderMultiChart(allStats, totalInitial) {
  const ctx = $('equityChart').getContext('2d');
  if (chart) chart.destroy();

  // Collect all unique dates across all strategies
  const allDates = new Set();
  for (const name of STRATEGY_NAMES) {
    const curve = allStats[name]?.equityCurve || [];
    curve.forEach(c => allDates.add(c.date));
  }
  const labels = [...allDates].sort();

  const datasets = STRATEGY_NAMES.map(name => {
    const curve = allStats[name]?.equityCurve || [];
    const curveMap = {};
    curve.forEach(c => { curveMap[c.date] = c.equity; });

    // Fill missing dates with last known value
    const data = [];
    let last = allStats[name]?.initialCash || 2000;
    for (const d of labels) {
      if (curveMap[d] !== undefined) {
        last = curveMap[d];
      }
      data.push(last);
    }

    return {
      label: STRATEGY_LABELS[name] || name,
      data,
      borderColor: STRATEGY_COLORS[name],
      backgroundColor: STRATEGY_COLORS[name] + '15',
      fill: false,
      tension: .3,
      pointRadius: data.length > 30 ? 0 : 3,
      pointHoverRadius: 5,
      borderWidth: 2,
    };
  });

  // Add baseline
  datasets.push({
    label: 'Baseline ($2,000)',
    data: Array(labels.length).fill(2000),
    borderColor: '#334155',
    borderDash: [4, 4],
    borderWidth: 1,
    pointRadius: 0,
    fill: false,
  });

  chart = new Chart(ctx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1e293b', titleColor: '#e2e8f0', bodyColor: '#e2e8f0',
          borderColor: '#334155', borderWidth: 1,
          callbacks: { label: ctx => `${ctx.dataset.label}: $${ctx.parsed.y.toLocaleString('en-US',{minimumFractionDigits:2})}` }
        }
      },
      scales: {
        x: { grid: { color: '#1e293b' }, ticks: { color: '#64748b', maxTicksLimit: 10, font: { size: 11 } } },
        y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b', font: { size: 11 }, callback: v => '$' + v.toLocaleString() } }
      }
    }
  });

  // Custom legend
  const legend = $('chartLegend');
  legend.innerHTML = STRATEGY_NAMES.map(name => {
    return `<div class="chart-legend-item" onclick="toggleDataset('${name}')">
      <span class="chart-legend-dot" style="background:${STRATEGY_COLORS[name]}"></span>
      <span>${STRATEGY_LABELS[name]}</span>
    </div>`;
  }).join('');
}

function toggleDataset(name) {
  if (!chart) return;
  const idx = STRATEGY_NAMES.indexOf(name);
  if (idx === -1) return;
  const meta = chart.getDatasetMeta(idx);
  meta.hidden = !meta.hidden;
  chart.update();
  // Toggle visual
  const items = document.querySelectorAll('.chart-legend-item');
  if (items[idx]) {
    items[idx].style.opacity = meta.hidden ? '0.3' : '0.9';
  }
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

// â”€â”€ Tab Switching â”€â”€
function switchTab(tab){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===tab));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.toggle('active',c.id==='tab-'+tab));
  if(tab==='strategies'&&!window._stratLoaded)loadStrategies();
}

// â”€â”€ Strategy Library â”€â”€
async function loadStrategies(){
  try{
    const data=await fetch('data/strategies.json').then(r=>r.json());
    window._stratLoaded=true;
    renderStrategies(data);
  }catch(e){
    console.error('Failed to load strategies:',e);
    $('stratGrid').innerHTML='<div class="empty" style="grid-column:1/-1"><div class="icon">âš ï¸</div><p>Failed to load strategies data.</p></div>';
  }
}

function riskClass(r){
  const rl=r.toLowerCase();
  if(rl.includes('very low')||rl==='low')return 'risk-low';
  if(rl.includes('low'))return 'risk-mixed';
  if(rl==='medium')return 'risk-medium';
  if(rl.includes('high'))return 'risk-high';
  return 'risk-medium';
}

function riskLabel(r){
  const rl=r.toLowerCase();
  if(rl.includes('very low'))return 'ğŸŸ¢ Very Low';
  if(rl==='low')return 'ğŸŸ¢ Low';
  if(rl.includes('low-medium')||rl.includes('low'))return 'ğŸŸ¡ Low-Med';
  if(rl==='medium')return 'ğŸŸ¡ Medium';
  if(rl.includes('high'))return 'ğŸ”´ High';
  return 'âšª '+r;
}

function renderStrategies(data){
  if(data.lastUpdated){
    const d=new Date(data.lastUpdated);
    $('stratUpdated').innerHTML=`<span class="pulse-dot"></span> Last updated: ${d.toLocaleString('en-US',{dateStyle:'medium',timeStyle:'short'})}`;
  }

  const sg=$('stratGrid');
  if(data.strategies&&data.strategies.length>0){
    sg.innerHTML=data.strategies.map(s=>{
      const applTags=(s.applicability||'').split(',').map(t=>t.trim()).filter(Boolean).map(t=>`<span class="appl-badge">${esc(t)}</span>`).join('');
      const rBadge=s.risk?`<span class="risk-badge ${riskClass(s.risk)}">${riskLabel(s.risk)}</span>`:'';
      const sourceLink=s.sourceUrl?`<a href="${esc(s.sourceUrl)}" target="_blank" rel="noopener">ğ• ${esc(s.source)}</a>`:esc(s.source);
      return `<div class="strat-card">
        <div class="strat-name">${esc(s.name)}</div>
        <div class="strat-desc">${esc(s.description)}</div>
        <div class="strat-tags">${rBadge}${applTags}</div>
        <div class="strat-source">Source: ${sourceLink}</div>
      </div>`;
    }).join('');
  }else{
    sg.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="icon">ğŸ“š</div><p>No strategies found.</p></div>';
  }

  const wg=$('walletsGrid');
  if(data.notableWallets&&data.notableWallets.length>0){
    wg.innerHTML=data.notableWallets.map(w=>{
      const initial=w.name.charAt(0).toUpperCase();
      const sourceLink=w.source?`<a href="${esc(w.source)}" target="_blank" rel="noopener">View source â†’</a>`:'';
      return `<div class="wallet-card">
        <div class="wallet-avatar">${initial}</div>
        <div class="wallet-info">
          <div class="wname">${esc(w.name)}</div>
          <div class="wstats">${esc(w.stats)}</div>
          <div class="wsource">${sourceLink}</div>
        </div>
      </div>`;
    }).join('');
  }else{
    wg.innerHTML='<div class="empty"><div class="icon">ğŸ‘›</div><p>No notable wallets.</p></div>';
  }

  const kl=$('kolList');
  if(data.kols&&data.kols.length>0){
    kl.innerHTML=data.kols.map(h=>{
      const handle=h.startsWith('@')?h:'@'+h;
      const username=handle.slice(1);
      return `<a class="kol-chip" href="https://x.com/${esc(username)}" target="_blank" rel="noopener"><span class="x-icon">ğ•</span> ${esc(handle)}</a>`;
    }).join('');
  }else{
    kl.innerHTML='<span class="kol-chip">No KOLs tracked</span>';
  }
}

loadData();
</script>
</body>
</html>
